<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fleming Fantasy Parley Submission</title>
    <style>
        body {
            background-color: white;
            color: red;
        }
        table {
            width: 40%;
            border-collapse: collapse;
            margin-left: 0;
            background-color: white;
        }
        th, td {
            border: 1px solid red;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: white;
        }
        button {
            background-color: red;
            color: white;
            border: none;
            padding: 5px 10px;
        }
    </style>
</head>
<body>
    <h1>Fleming Fantasy Parley Submission</h1>
    <p><strong>Instructions:</strong> First enter Odds, then the Bet. Once your bet is set for the week, click Submit to lock it. Do not click 'Reset', that is only for Tomas to reset at the end of each week.</p>

    <table>
        <thead>
            <tr>
                <th>User</th>
                <th>Bet</th>
                <th>Odds</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody id="betsContainer"></tbody>
    </table>

    <button type="button" onclick="resetFields()">Reset</button>

    <h2>Results</h2>
    <p id="totalOdds">Total Parley Odds: N/A</p>
    <p id="potentialReturn">Potential Return: N/A</p>
    <p id="roi">ROI: N/A</p>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-database.js"></script>

    <script>
        // Wait for the DOM to load before Firebase and table are set up
        document.addEventListener('DOMContentLoaded', function () {
            // Initialize Firebase
            const firebaseConfig = {
                apiKey: "AIzaSyBY6FQqGz00OSryt4n5BAMhgE-G62bqomM",
                authDomain: "ffparley.firebaseapp.com",
                databaseURL: "https://ffparley-default-rtdb.firebaseio.com",
                projectId: "ffparley",
                storageBucket: "ffparley.appspot.com",
                messagingSenderId: "1054701123200",
                appId: "1:1054701123200:web:c4038e7fa1e561d3c1d865",
                measurementId: "G-1LC7BC64XP"
            };
            firebase.initializeApp(firebaseConfig);
            const database = firebase.database();

            const users = ["Tomas", "Harrison", "Mojo", "Chris", "Patric", "Daniel", "Chatt", "DK", "Nick", "Parth", "Sandia", "Dylan", "Rush", "Alec"];

            // Generate table rows for each user
            const betsContainer = document.getElementById('betsContainer');
            users.forEach(user => {
                const row = document.createElement('tr');

                const userCell = document.createElement('td');
                userCell.textContent = user;
                row.appendChild(userCell);

                const betCell = document.createElement('td');
                const betInput = document.createElement('input');
                betInput.type = 'text';
                betInput.id = `${user.toLowerCase()}_bet`;
                betCell.appendChild(betInput);
                row.appendChild(betCell);

                const oddsCell = document.createElement('td');
                const oddsInput = document.createElement('input');
                oddsInput.type = 'number';
                oddsInput.id = `${user.toLowerCase()}_odds`;
                oddsCell.appendChild(oddsInput);
                row.appendChild(oddsCell);

                const actionCell = document.createElement('td');
                const submitButton = document.createElement('button');
                submitButton.textContent = 'Submit';
                submitButton.onclick = function () {
                    submitBet(user.toLowerCase());
                };
                actionCell.appendChild(submitButton);
                row.appendChild(actionCell);

                betsContainer.appendChild(row);
            });

            function convertAmericanToDecimal(americanOdds) {
                return americanOdds > 0 ? (americanOdds / 100) + 1 : (100 / Math.abs(americanOdds)) + 1;
            }

            function calculateParley() {
                let totalOdds = 1, betsEntered = false;

                users.forEach(user => {
                    const odds = parseFloat(document.getElementById(`${user.toLowerCase()}_odds`).value);
                    if (!isNaN(odds)) {
                        totalOdds *= convertAmericanToDecimal(odds);
                        betsEntered = true;
                    }
                });

                if (!betsEntered) {
                    document.getElementById('totalOdds').innerText = "Total Parley Odds: N/A";
                    document.getElementById('potentialReturn').innerText = "Potential Return: N/A";
                    document.getElementById('roi').innerText = "ROI: N/A";
                    return;
                }

                const stake = 10, potentialReturn = stake * totalOdds, roi = ((potentialReturn - stake) / stake) * 100;
                document.getElementById('totalOdds').innerText = `Total Parley Odds: ${totalOdds.toFixed(2)}`;
                document.getElementById('potentialReturn').innerText = `Potential Return: $${potentialReturn.toFixed(2)}`;
                document.getElementById('roi').innerText = `ROI: ${roi.toFixed(2)}%`;
            }

            function submitBet(user) {
                const betField = document.getElementById(`${user}_bet`);
                const oddsField = document.getElementById(`${user}_odds`);

                if (betField.value && oddsField.value) {
                    betField.disabled = true;
                    oddsField.disabled = true;

                    // Save data to Firebase Realtime Database
                    database.ref('submissions/' + user).set({
                        bet: betField.value,
                        odds: oddsField.value
                    });
                }

                calculateParley();
            }

            function resetFields() {
                users.forEach(user => {
                    document.getElementById(`${user.toLowerCase()}_bet`).disabled = false;
                    document.getElementById(`${user.toLowerCase()}_odds`).disabled = false;
                    document.getElementById(`${user.toLowerCase()}_bet`).value = "";
                    document.getElementById(`${user.toLowerCase()}_odds`).value = "";
                    database.ref('submissions/' + user).remove();
                });
                document.getElementById('totalOdds').innerText = "Total Parley Odds: N/A";
                document.getElementById('potentialReturn').innerText = "Potential Return: N/A";
                document.getElementById('roi').innerText = "ROI: N/A";
            }

            function restoreFields() {
                users.forEach(user => {
                    database.ref('submissions/' + user).once('value').then(snapshot => {
                        if (snapshot.exists()) {
                            const data = snapshot.val();
                            document.getElementById(`${user.toLowerCase()}_bet`).value = data.bet;
                            document.getElementById(`${user.toLowerCase()}_odds`).value = data.odds;
                            document.getElementById(`${user.toLowerCase()}_bet`).disabled = true;
                            document.getElementById(`${user.toLowerCase()}_odds`).disabled = true;
                        }
                    });
                });
            }

            restoreFields();  // Restore data from Firebase after the table has been built
        });
    </script>
</body>
</html>
