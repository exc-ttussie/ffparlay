<!DOCTYPE html>
<html>
<head>
    <title>Fleming Fantasy Parley Submission</title>
    <style>
        body {
            background-color: white;
            color: red;
        }
        table {
            width: 40%;
            border-collapse: collapse;
            margin-left: 0;
            background-color: white;
        }
        th, td {
            border: 1px white;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: white;
        }
        button {
            background-color: red;
            color: white;
            border: none;
            padding: 5px 10px;
        }
    </style>
</head>
<body>
    <h1>Fleming Fantasy Parley Submission</h1>
    <p><strong>Instructions:</strong> First enter Odds, then the Bet. Once your bet is set for the week, click Submit to lock it. Do not click 'Reset', that is only for Tomas to reset at the end of each week.</p>

    <table>
        <thead>
            <tr>
                <th>User</th>
                <th>Bet</th>
                <th>Odds</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody id="betsContainer"></tbody>
    </table>

    <button type="button" onclick="resetFields()">Reset</button>

    <h2>Results</h2>
    <p id="totalOdds">Total Parley Odds: N/A</p>
    <p id="potentialReturn">Potential Return: N/A</p>
    <p id="roi">ROI: N/A</p>

    <!-- Firebase SDK and Config -->
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-database.js"></script>
    <script>
      // Your Firebase configuration
      const firebaseConfig = {
          apiKey: "AIzaSyBY6FQqGz00OSryt4n5BAMhgE-G62bqomM",
          authDomain: "ffparley.firebaseapp.com",
          databaseURL: "https://ffparley-default-rtdb.firebaseio.com",
          projectId: "ffparley",
          storageBucket: "ffparley.appspot.com",
          messagingSenderId: "1054701123200",
          appId: "1:1054701123200:web:c4038e7fa1e561d3c1d865",
          measurementId: "G-1LC7BC64XP"
        };
      // Initialize Firebase
      firebase.initializeApp(firebaseConfig);
    </script>

    <script>
        const users = ["Tomas", "Harrison", "Mojo", "Chris", "Patric", "Daniel", "Chatt", "DK", "Nick", "Parth", "Sandia", "Dylan", "Rush", "Alec"];

        // Dynamically generate input fields and submit button for each user
        const betsContainer = document.getElementById('betsContainer');
        users.forEach(user => {
            betsContainer.innerHTML += `
                <tr>
                    <td>${user}</td>
                    <td><input type="text" id="${user.toLowerCase()}_bet"></td>
                    <td><input type="number" id="${user.toLowerCase()}_odds"></td>
                    <td><button onclick="submitBet('${user.toLowerCase()}')">Submit</button></td>
                </tr>
            `;
        });

        function convertAmericanToDecimal(americanOdds) {
            return americanOdds > 0 ? (americanOdds / 100) + 1 : (100 / Math.abs(americanOdds)) + 1;
        }

        function calculateParley() {
            let totalOdds = 1, betsEntered = false;

            users.forEach(user => {
                const odds = parseFloat(document.getElementById(`${user.toLowerCase()}_odds`).value);
                if (!isNaN(odds)) {
                    totalOdds *= convertAmericanToDecimal(odds);
                    betsEntered = true;
                }
            });

            if (!betsEntered) {
                document.getElementById('totalOdds').innerText = "Total Parley Odds: N/A";
                document.getElementById('potentialReturn').innerText = "Potential Return: N/A";
                document.getElementById('roi').innerText = "ROI: N/A";
                return;
            }

            const stake = 10, potentialReturn = stake * totalOdds, roi = ((potentialReturn - stake) / stake) * 100;
            document.getElementById('totalOdds').innerText = `Total Parley Odds: ${totalOdds.toFixed(2)}`;
            document.getElementById('potentialReturn').innerText = `Potential Return: $${potentialReturn.toFixed(2)}`;
            document.getElementById('roi').innerText = `ROI: ${roi.toFixed(2)}%`;
        }

        function submitBet(user) {
            const betField = document.getElementById(`${user}_bet`);
            const oddsField = document.getElementById(`${user}_odds`);

            if (betField.value && oddsField.value) {
                betField.disabled = true;
                oddsField.disabled = true;
                
                // Store data in Firebase
                firebase.database().ref(`submissions/${user}`).set({
                    bet: betField.value,
                    odds: oddsField.value
                });
            }

            calculateParley();
        }

        function resetFields() {
            users.forEach(user => {
                const userKey = user.toLowerCase();  // Ensure lowercase key is used
                document.getElementById(`${userKey}_bet`).disabled = false;
                document.getElementById(`${userKey}_odds`).disabled = false;
                document.getElementById(`${userKey}_bet`).value = "";
                document.getElementById(`${userKey}_odds`).value = "";
        
                // Remove from Firebase using the correct lowercase path
                firebase.database().ref(`submissions/${userKey}`).remove();
            });
            document.getElementById('totalOdds').innerText = "Total Parley Odds: N/A";
            document.getElementById('potentialReturn').innerText = "Potential Return: N/A";
            document.getElementById('roi').innerText = "ROI: N/A";
        }


        function restoreFields() {
            let promises = [];
    
            users.forEach(user => {
                const userKey = user.toLowerCase();
                let promise = firebase.database().ref(`submissions/${userKey}`).once('value').then(snapshot => {
                    if (snapshot.exists()) {
                        const data = snapshot.val();
                        document.getElementById(`${userKey}_bet`).value = data.bet;
                        document.getElementById(`${userKey}_odds`).value = data.odds;
                        document.getElementById(`${userKey}_bet`).disabled = true;
                        document.getElementById(`${userKey}_odds`).disabled = true;
                    }
                });
                promises.push(promise);
            });

            // Once all fields are restored, calculate parley
            Promise.all(promises).then(() => {
                calculateParley();
            });
        }



        window.onload = restoreFields;
    </script>
</body>
</html>
